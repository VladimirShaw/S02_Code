# 072-5/072-6 åˆ·æ–°æ­¥éª¤å¾ªç¯ç³»ç»Ÿå®ç°æŠ¥å‘Š

## ğŸ¯ **ç³»ç»Ÿæ¦‚è¿°**

å®ç°äº†åŸºäºå›¾ç‰‡æ—¶é—´è½´çš„è¿·å®«å‰¯æœ¬å…‰æ•ˆè½®æ’­ç³»ç»Ÿï¼ŒåŒ…å«072-5å’Œ072-6ä¸¤ä¸ªåˆ·æ–°æ­¥éª¤çš„æ™ºèƒ½å¾ªç¯æœºåˆ¶ã€‚

## ğŸ”„ **æ ¸å¿ƒå¾ªç¯æœºåˆ¶**

### **å¾ªç¯é€»è¾‘**
```
ä¸Šæ¬¡æ‰§è¡Œ â†’ ä¸‹æ¬¡æ‰§è¡Œ
072-5   â†’ 072-6
072-6   â†’ 072-5
```

### **è§¦å‘æ¥æº**
- âœ… **æ­£ç¡®æ“ä½œå®Œæˆ** â†’ åˆ·æ–°æ­¥éª¤å¾ªç¯
- âŒ **é”™è¯¯æ“ä½œ** â†’ é”™è¯¯æ­¥éª¤(-7/-8/-9) â†’ åˆ·æ–°æ­¥éª¤å¾ªç¯
- ğŸ”„ **å¤±è´¥ç¯èŠ‚å®šæ—¶è·³è½¬** â†’ åˆ·æ–°æ­¥éª¤å¾ªç¯

## ğŸ“Š **å…‰æ•ˆæ—¶é—´è½´å®ç°**

### **072-5 (è¿·å®«å‰¯æœ¬å…‰æ•ˆ1)**
```
æ—¶é—´è½´: 1000msæ€»æ—¶é•¿ï¼Œæ¯200msåˆ‡æ¢ä¸€ç»„æŒ‰é”®
0-200ms:   æŒ‰é”®1
100-300ms: æŒ‰é”®2,6
200-400ms: æŒ‰é”®3,7,11
300-500ms: æŒ‰é”®4,8,12,16
400-600ms: æŒ‰é”®5,9,13,17,21
500-700ms: æŒ‰é”®10,14,18,22
600-800ms: æŒ‰é”®15,19,23
700-900ms: æŒ‰é”®20,24
800-1000ms: æŒ‰é”®25
1000ms:    æ‰€æœ‰æŒ‰é”®å…³é—­
```

### **072-6 (è¿·å®«å‰¯æœ¬å…‰æ•ˆ2)**
```
æ—¶é—´è½´: 1000msæ€»æ—¶é•¿ï¼Œä¸åŒçš„æŒ‰é”®ç»„åˆåºåˆ—
0-200ms:   æŒ‰é”®5
100-300ms: æŒ‰é”®4,10
200-400ms: æŒ‰é”®3,9,6
300-500ms: æŒ‰é”®2,8,14,20
400-600ms: æŒ‰é”®1,7,13,19,25
500-700ms: æŒ‰é”®6,12,18,24
600-800ms: æŒ‰é”®11,17,23
700-900ms: æŒ‰é”®16,22
800-1000ms: æŒ‰é”®21
1000ms:    æ‰€æœ‰æŒ‰é”®å…³é—­
```

## ğŸ—ï¸ **æŠ€æœ¯æ¶æ„**

### **A. GameFlowManagerå¢å¼º**

#### 1. å¾ªç¯çŠ¶æ€è¿½è¸ª
```cpp
class GameFlowManager {
private:
    static bool lastRefreshWas5;  // è®°å½•ä¸Šæ¬¡åˆ·æ–°æ˜¯å¦ä¸º-5
    
public:
    String getNextRefreshStage();                    // è·å–ä¸‹ä¸€ä¸ªåˆ·æ–°æ­¥éª¤
    void recordRefreshStage(const String& stageId);  // è®°å½•æ‰§è¡Œçš„åˆ·æ–°æ­¥éª¤
    void resetRefreshCycle();                        // é‡ç½®åˆ·æ–°å¾ªç¯
};
```

#### 2. æ™ºèƒ½è·³è½¬é€»è¾‘
```cpp
// é”™è¯¯å¤„ç† - è·³è½¬åˆ°å¾ªç¯åˆ·æ–°æ­¥éª¤
void handleGameError(int failedButton) {
    String refreshStep = getNextRefreshStage();
    notifyStageComplete(buildStageId("0.5"), refreshStep, duration);
}

// æ¸¸æˆå®Œæˆ - è·³è½¬åˆ°å¾ªç¯åˆ·æ–°æ­¥éª¤
void handleGameComplete() {
    String refreshStep = getNextRefreshStage();
    notifyStageComplete(buildStageId("0.5"), refreshStep, duration);
}
```

#### 3. å¤±è´¥ç¯èŠ‚æ›´æ–°
```cpp
// 072-7/8/9 å®šæ—¶è·³è½¬ä½¿ç”¨å¾ªç¯åˆ·æ–°æ­¥éª¤
void defineStage072_7() {
    String nextRefreshStage = getNextRefreshStage();
    gameStage.jumpToStage(16000, nextRefreshStage);  // 16ç§’åè·³è½¬
}
```

### **B. SimpleGameStageå¢å¼º**

#### 1. ç‰¹æ®ŠåŠŸèƒ½æ”¯æŒ
```cpp
// LED_OFFæ”¯æŒå…³é—­æ‰€æœ‰æŒ‰é”® (pin=-1)
case LED_OFF:
    if (segment.pin == -1) {
        // å…³é—­æ‰€æœ‰25ä¸ªæŒ‰é”®
        for (int i = 1; i <= 25; i++) {
            MillisPWM::setBrightness(getButtonPin(i), 0);
        }
    }
```

#### 2. æ—¶é—´è½´ç²¾ç¡®æ§åˆ¶
- ä½¿ç”¨`gameStage.duration()`å®ç°é‡å æ—¶é—´æ®µ
- æ¯«ç§’çº§ç²¾åº¦çš„æŒ‰é”®æ§åˆ¶
- è‡ªåŠ¨æ¸…ç†å’ŒçŠ¶æ€ç®¡ç†

## ğŸ”§ **ä½¿ç”¨æ–¹æ³•**

### **åŸºæœ¬æ“ä½œ**
```cpp
// ç³»ç»Ÿè‡ªåŠ¨å¤„ç†å¾ªç¯ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
gameFlowManager.startStage("072-5");  // ä¼šè‡ªåŠ¨è®°å½•ä¸ºä¸Šæ¬¡æ‰§è¡Œ-5

// ä¸‹æ¬¡è·å–åˆ·æ–°æ­¥éª¤æ—¶ä¼šè¿”å›-6
String next = gameFlowManager.getNextRefreshStage();  // è¿”å›"072-6"
```

### **é‡ç½®å¾ªç¯**
```cpp
// æ¸¸æˆé‡æ–°å¼€å§‹æ—¶é‡ç½®å¾ªç¯
gameFlowManager.resetRefreshCycle();  // ä¸‹æ¬¡ä»-5å¼€å§‹
```

### **é…ç½®ä¸åŒå‰ç¼€**
```cpp
// æ”¯æŒä¸åŒæ¸¸æˆçš„å‰ç¼€
gameFlowManager.setStagePrefix("073-");  // ç°åœ¨ä¼šå¾ªç¯073-5å’Œ073-6
```

## ğŸ“ˆ **ç³»ç»Ÿæµç¨‹**

### **å®Œæ•´æ¸¸æˆæµç¨‹**
```
1. æ¸¸æˆå¼€å§‹ â†’ 072-0 (åˆå§‹åŒ–)
2. å‡†å¤‡é˜¶æ®µ â†’ 072-0.5 (æŒ‰é”®ç›‘å¬)
3. æ­£ç¡®/é”™è¯¯æ“ä½œ â†’ åˆ·æ–°æ­¥éª¤å¾ªç¯
   - ç¬¬1æ¬¡: 072-5 (å…‰æ•ˆ1)
   - ç¬¬2æ¬¡: 072-6 (å…‰æ•ˆ2) 
   - ç¬¬3æ¬¡: 072-5 (å…‰æ•ˆ1)
   - ... å¾ªç¯ç»§ç»­
4. é”™è¯¯å¤„ç† â†’ 072-7/8/9 â†’ åˆ·æ–°æ­¥éª¤å¾ªç¯
```

### **é”™è¯¯å¤„ç†æµç¨‹**
```
é”™è¯¯å‘ç”Ÿ â†’ é”™è¯¯æ­¥éª¤é€‰æ‹© â†’ å®šæ—¶æ•ˆæœ â†’ åˆ·æ–°æ­¥éª¤å¾ªç¯
072-0.5 â†’ 072-7 (16ç§’) â†’ ä¸‹ä¸€ä¸ªåˆ·æ–°æ­¥éª¤
072-0.5 â†’ 072-8 (12ç§’) â†’ ä¸‹ä¸€ä¸ªåˆ·æ–°æ­¥éª¤  
072-0.5 â†’ 072-9 (9ç§’)  â†’ ä¸‹ä¸€ä¸ªåˆ·æ–°æ­¥éª¤
```

## âœ… **åŠŸèƒ½éªŒè¯**

### **å·²å®ç°åŠŸèƒ½**
- âœ… 072-5å’Œ072-6çš„å®Œæ•´å…‰æ•ˆæ—¶é—´è½´
- âœ… åˆ·æ–°æ­¥éª¤æ™ºèƒ½å¾ªç¯è¿½è¸ª
- âœ… é”™è¯¯å¤„ç†é›†æˆå¾ªç¯æœºåˆ¶
- âœ… æ¸¸æˆå®Œæˆé›†æˆå¾ªç¯æœºåˆ¶
- âœ… å¤±è´¥ç¯èŠ‚å®šæ—¶è·³è½¬ä½¿ç”¨å¾ªç¯
- âœ… å¯é…ç½®å‰ç¼€æ”¯æŒ
- âœ… å‘åå…¼å®¹æ€§ä¿è¯

### **æµ‹è¯•åœºæ™¯**
1. **é¦–æ¬¡æ¸¸æˆ**: é»˜è®¤ä»072-5å¼€å§‹
2. **è¿ç»­æ¸¸æˆ**: è‡ªåŠ¨åœ¨072-5å’Œ072-6é—´å¾ªç¯
3. **é”™è¯¯å¤„ç†**: é”™è¯¯åè·³è½¬åˆ°æ­£ç¡®çš„ä¸‹ä¸€ä¸ªåˆ·æ–°æ­¥éª¤
4. **å‰ç¼€åˆ‡æ¢**: æ”¯æŒ073-ã€074-ç­‰ä¸åŒå‰ç¼€

## ğŸ® **æ¸¸æˆä½“éªŒ**

### **è§†è§‰æ•ˆæœ**
- **072-5**: ä»å•ç‚¹æ‰©æ•£çš„æ³¢æµªå¼å…‰æ•ˆ
- **072-6**: ä¸åŒçš„å‡ ä½•å›¾æ¡ˆè½®æ’­
- **æ— ç¼å¾ªç¯**: æ¯æ¬¡åˆ·æ–°éƒ½æœ‰ä¸åŒçš„è§†è§‰ä½“éªŒ

### **æ—¶é—´æ§åˆ¶**
- **ç²¾ç¡®æ—¶é—´è½´**: æ¯«ç§’çº§æ§åˆ¶ï¼Œç¡®ä¿æµç•…ä½“éªŒ
- **é‡å æ•ˆæœ**: å¤šä¸ªæŒ‰é”®åŒæ—¶äº®èµ·çš„åŠ¨æ€æ•ˆæœ
- **è‡ªåŠ¨æ¸…ç†**: 1ç§’åè‡ªåŠ¨å…³é—­æ‰€æœ‰æŒ‰é”®

## ğŸ”® **æ‰©å±•æ€§**

ç³»ç»Ÿè®¾è®¡å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼š
- **æ–°å¢åˆ·æ–°æ­¥éª¤**: å¯è½»æ¾æ·»åŠ 072-7ã€072-8ç­‰æ–°çš„åˆ·æ–°ç¯èŠ‚
- **å¤æ‚å¾ªç¯**: æ”¯æŒAâ†’Bâ†’Câ†’Açš„å¤šæ­¥å¾ªç¯
- **ä¸åŒæ¸¸æˆ**: é€šè¿‡å‰ç¼€é…ç½®æ”¯æŒå¤šä¸ªæ¸¸æˆç³»ç»Ÿ
- **è‡ªå®šä¹‰æ—¶é—´è½´**: å¯è°ƒæ•´å…‰æ•ˆåºåˆ—å’Œæ—¶é—´

## ğŸ“ **æ€»ç»“**

æˆåŠŸå®ç°äº†å®Œæ•´çš„072-5/072-6åˆ·æ–°æ­¥éª¤å¾ªç¯ç³»ç»Ÿï¼ŒåŒ…å«ï¼š
1. **æ™ºèƒ½å¾ªç¯æœºåˆ¶** - è‡ªåŠ¨è¿½è¸ªå’Œåˆ‡æ¢
2. **ç²¾ç¡®å…‰æ•ˆæ—¶é—´è½´** - åŸºäºå›¾ç‰‡è§„æ ¼çš„æ¯«ç§’çº§æ§åˆ¶
3. **å®Œæ•´é›†æˆ** - ä¸é”™è¯¯å¤„ç†ã€æ¸¸æˆå®Œæˆã€å¤±è´¥ç¯èŠ‚çš„æ— ç¼é›†æˆ
4. **é«˜åº¦å¯é…ç½®** - æ”¯æŒä¸åŒå‰ç¼€å’Œæ‰©å±•

ç³»ç»Ÿç°åœ¨èƒ½å¤Ÿæä¾›ä¸°å¯Œå¤šæ ·çš„æ¸¸æˆä½“éªŒï¼Œç¡®ä¿æ¯æ¬¡åˆ·æ–°éƒ½æœ‰ä¸åŒçš„è§†è§‰æ•ˆæœï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¸…æ™°æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 