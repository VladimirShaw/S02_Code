# C102 - 002_0环节多环节跳转测试

## 功能描述

002_0环节现在支持在运行30秒时自动触发多环节跳转，向服务器发送跳转请求，包含4个目标环节：
- 006_0
- 007_0  
- 009_0
- 010_0

## 配置参数

```cpp
// 002_0 环节配置
#define STAGE_002_0_CHANNEL1        1        // 第1播放通道
#define STAGE_002_0_SONG_ID1        2        // 第1播放歌曲ID
#define STAGE_002_0_CHANNEL1_START  0        // 第1通道启动时间(ms)
#define STAGE_002_0_CHANNEL2        2        // 第2播放通道
#define STAGE_002_0_SONG_ID2        203      // 第2播放歌曲ID
#define STAGE_002_0_CHANNEL2_START  0        // 第2通道启动时间(ms)
#define STAGE_002_0_MULTI_JUMP_TIME 30000    // 30秒时触发多环节跳转
#define STAGE_002_0_MULTI_JUMP_STAGES "006_0,007_0,009_0,010_0"  // 多环节跳转目标
#define STAGE_002_0_DURATION        60000    // 60秒默认时长
#define STAGE_002_0_NEXT_STAGE      ""       // 跳转目标环节（空字符串表示只报告完成，不跳转）
```

## 执行流程

1. **0ms**: 环节启动
   - 通道1开始播放2号音频
   - 通道2开始播放203号音频
   - 重置通道2音量为默认值30

2. **30000ms (30秒)**: 触发多环节跳转
   - 发送多环节跳转请求给服务器
   - 目标环节: "006_0,007_0,009_0,010_0"
   - 继续播放音频

3. **60000ms (60秒)**: 环节完成
   - 报告环节完成（不指定下一环节）

## 测试命令

```
// 启动002_0环节
STEP 002_0
```

## 预期输出

### Arduino串口监视器
```
=== 启动C102音频环节[槽位X]: 002_0 ===
🎵 环节002_0：通道1播放2(0ms)，通道2播放203(0ms)
🔊 确保通道2音量为默认值
⏳ 等待各通道到达启动时间...
✅ 成功跳转到环节: 002_0

🎵 [槽位X] 0ms: 通道1开始播放2
🎵 [槽位X] 0ms: 通道2开始播放203

// 30秒后
🚀 [槽位X] 30秒时触发多环节跳转: 006_0,007_0,009_0,010_0
📡 多环节跳转请求: $[GAME]@C102{^STEP_COMPLETE^(current_step="002_0",next_step="006_0,007_0,009_0,010_0",duration=30000,error_count=0)}#

// 60秒后
⏰ [槽位X] 环节002_0完成
📡 环节完成通知: $[GAME]@C102{^STEP_COMPLETE^(current_step="002_0",duration=60000,error_count=0)}#
```

### 服务器日志
```
✅ 解析成功: GAME.STEP_COMPLETE for C102
🎮 游戏消息: C102 - STEP_COMPLETE - {'current_step': '002_0', 'next_step': '006_0,007_0,009_0,010_0', 'duration': 30000, 'error_count': 0}
✅ 🔄 Arduino请求自动跳转: "002_0" → "006_0,007_0,009_0,010_0"
```

## 注意事项

1. **多环节跳转只触发一次**: 使用`multiJumpTriggered`标志防止重复触发
2. **继续运行**: 30秒跳转后，002_0环节继续运行到60秒完成
3. **服务器处理**: 服务器需要支持解析逗号分隔的多环节跳转请求
4. **目标环节**: 006_0、007_0、009_0、010_0环节由其他主板或后续实现负责

## 相关文件

- `C102/GameFlowManager.h` - 配置参数定义
- `C102/GameFlowManager.cpp` - 实现逻辑
- `C102/GameProtocolHandler.cpp` - 网络通信处理 